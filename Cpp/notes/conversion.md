# 隐式转换

凡是在语境中使用了某种表达式类型 T1, 但语境不接受该类型, 而接受另一类型 T2 的时候, 会进行隐式转换

### 布尔转换

整数, 浮点, 无作用域枚举, 指针和成员指针类型的纯右值, 可转换成 bool 类型的纯右值
零值(对于整数, 浮点和无作用域枚举), 空指针值和空成员指针值变为 false, 所有其他值变为 true

### 整型提升

小整型类型的纯右值可转换为较大整型类型的纯右值.具体而言, 算术运算符不接受小于 int 的类型为其实参
而在左值到右值转换后, 若适用则自动实施整型提升.此转换始终保持原值

### 浮点提升

float 类型纯右值可转换为 double 类型的纯右值, 值不更改

### 整型转换

任何整数类型或无作用域枚举类型的纯右值都可隐式转换成任何其他整数类型
若其转换列出于整数类型提升之下, 则它是提升而非转换

- 若目标类型为无符号, 则结果值是等于源值模 2^n 的最小无符号值, 其中 n 是用于表示目标类型的位数。
  取决于目标类型更宽或更窄, 分别对有符号数进行符号扩展或截断, 而对无符号数进行零扩展或截断。
- 若目标类型为有符号, 则当源整数能以目标类型表示时, 不更改其值.否则结果是与源值对 2^n
  同余的唯一目标类型值, 其中 n 是用于表示目标类型的位数(注意这不同于未定义的有符号整数算术溢出)
- 若源类型为 bool, 则值 false 转换为目标类型的零, 而值 true 转换成目标类型的一
  (注意若目标类型为 int, 则这是整数类型提升, 而非整数类型转换)
- 若目标类型为 bool, 则这是布尔转换

### 浮点转换

浮点类型的纯右值可转换成任何其他浮点类型的纯右值.若其转换列于浮点提升之下, 则它是提升而非转换。

- 若源值能以目标类型准确表示, 则不更改它
- 若源值处于目标类型的两个可表示值之间, 则结果是两个值之一
  选择哪个是**实现定义**的, 不过若支持 IEEE, 则舍入默认为到最接近
- 否则，行为**未定义**

### 浮点整型转换

- 浮点类型的纯右值可隐式转换成任何整数类型的纯右值.截断小数部分, 即舍弃小数部分
  若结果不能适应到目标类型中, 则行为**未定义**(即使在目标类型为无符号数时, 也不实施模算术)
  若目标类型为 bool, 则这是布尔转换
- 整数或无作用域枚举类型的纯右值可转换成任何浮点类型的纯右值.若不能正确表示该值,
  则选择与之最接近的较高值还是最接近的较低值是**实现定义**的, 不过若支持 IEEE, 则舍入默认为到最接近若其值不能适应到目标类型中, 则行为未定义.若源类型为 bool, 则值 false 转换为零
  而值 true 转换为一

# 转换

若传递给算术运算符的操作数是整型或无作用域枚举类型, 则在任何其他行动前
(但在左值到右值转换后, 若其适用),对操作数实施整型提升.若操作数之一具有数组或函数类型, 则实施数组到指针和函数到指针转换
对于(除移位之外的)二元运算符, 当提升后的操作数拥有不同类型时, 实施称为一般算术转换的一组额外的隐式转换, 目的是产生公共类型

- 若任一操作数具有有作用域枚举类型, 则不进行转换: 另一操作数和返回类型必须具有相同类型
- 否则, 若任一操作数为 long double, 则将另一操作数转换为 long double
- 否则, 若任一操作数为 double, 则将另一操作数转换为 double
- 否则, 若任一操作数为 float, 则将另一操作数转换为 float
- 否则, 操作数拥有整数类型, 并对其实施整型转换以产生如下的公共类型:
  - 若两个操作数均为有符号或均为无符号, 则将拥有较小转换等级的操作数转换为拥有较大整数转换等级的操作数的类型
  - 否则, 若无符号操作数的转换等级大于或等于有符号操作数的转换等级, 则将有符号操作数转换为无符号操作数的类型
  - 否则, 若有符号操作数的类型能表示无符号操作数类型的所有值, 则将无符号操作数转换为有符号操作数的类型
  - 否则, 将两个操作数都转换为有符号操作数的无符号对应版本

转换等级按 bool, signed char, short, int, long, long long 顺序递增
任何无符号类型的等级都等于其对应的有符号类型的等级.char 的等级等于 signed char 和 unsigned char 的等级
char16_t、char32_t 和 wchar_t 的等级等于其底层类型的等级

# 溢出

- 无符号整数算术始终进行 mod 2^n, 其中 n 是该整数的位数
- 有符号整数算术运算溢出时, 行为**未定义**

# 窄化转换

- 从浮点类型到整数类型的转换
- 从 long double 到 double 或 float 的转换, 以及从 double 到 float 的转换, 除非源是常量表达式且不发生溢出
- 从整数类型到浮点类型的转换, 除非源是其值能完全存储于目标类型的常量表达式
- 从整数或无作用域枚举类型到不能表示原类型所有值的整数类型的转换, 除非源是其值能完全存储于目标类型的常量表达式
- 从指针或成员指针类型到 bool 的转换
